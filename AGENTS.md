<!-- ────────────────────────────────────────────────────────────────────── -->
<!--  AGENTS.md  ·  Master Orchestration & Ticket Manifest                -->
<!--  4ndr0prompts – autogenerated: 2025-07-07                            -->
<!-- ────────────────────────────────────────────────────────────────────── -->

# AGENTS — 4ndr0prompts

> **Mission Statement**  
> Provide an audit-grade, automation-ready ticket ledger and architectural blueprint that elevates **4ndr0prompts** from its current *pre-release* state to a *stable, production-grade release* that satisfies modern Dev + Sec + Ops expectations while honouring the project’s guiding principles (minimalism, reproducibility, composability).

*Repository*: <https://github.com/4ndr0666/4ndr0prompts>  
*Generated*: 2025-07-07  
*Maintainer*: **@4ndr0666**  

---

## 0 · Table of Contents
1. [Executive Summary](#1--executive-summary)  
2. [Current File Tree Snapshot](#2--current-file-tree-snapshot)  
3. [Streams & Roles](#3--streams--roles)  
4. [Ticket Matrix](#4--ticket-matrix)  
5. [Detailed Ticket Specifications](#5--detailed-ticket-specifications)  
6. [Roadmap & Sprint Cadence](#6--roadmap--sprint-cadence)  
7. [Automation & Infrastructure Mandates](#7--automation--infrastructure-mandates)  
8. [Approval Rubric (Go/No-Go)](#8--approval-rubric--go-no-go)  
9. [Contribution Workflow](#9--contribution-workflow)  
10. [Further Enhancements (Post-Release)](#10--further-enhancements--post-release)  
11. [Glossary](#11--glossary)  
12. [Appendix A — Ticket YAML Stub](#appendix-a--ticket-yaml-stub)  
13. [Appendix B — ADR Template](#appendix-b--adr-template)  

---

## 1 · Executive Summary

**4ndr0prompts** currently operates in a **pre-release** state.  
A recent audit shows major functionality landed yet several compliance, packaging, and UX elements remain.

| Domain Area             | High-level Gap Statement                                                  |
| ----------------------- | ------------------------------------------------------------------------- |
| **Dataset Consistency** | Dual YAML/JSON artefacts; shell vs Python divergence risks.               |
| **CI & Coverage**       | Bats not executed in CI; statement coverage < 95 % threshold.             |
| **Cross-platform UX**   | Clipboard path only tested on Arch (xclip); Windows/macOS not covered.    |
| **Documentation**       | Man page & ADR skeletons exist but lack full content; README incomplete. |
| **Release Automation**  | No `release.yml`; SBOM, deterministic docker image, artefact signing TBD. |
| **Script Robustness**   | Several bash/Python entrypoints assume repo-root CWD; brittle in cron.    |

This manifest converts observations into **actionable, cross-referenced work tickets** with acceptance criteria tight enough for compliance audits and production gating.

---

## 2 · Current File Tree Snapshot
```

.
├── 0-tests/
│   ├── codex-generate.sh
│   └── codex-merge-clean.sh
├── AGENTS.md                    # (stub to be overwritten by this file)
├── bin/
│   ├── choose\_prompt.sh
│   └── prompts.sh
├── canonical\_loader.py
├── CHANGELOG.md
├── data/
│   └── templates.yaml
├── dataset/
│   ├── nsfwprompts.txt
│   ├── options.json
│   ├── rawdata.txt
│   ├── slots\_report.tsv
│   └── templates.json
├── docs/
│   ├── ADR-0001.md              # draft, incomplete
│   └── architecture.png
├── lib/
│   ├── **init**.py
│   └── promptgen.py
├── Makefile                     # WIP stub
├── man1/
│   └── prompts.1.scd            # skeleton
├── plugin\_loader.py
├── plugins/                     # third-party packs
│   └── **init**.py
├── prompt\_config.py
├── promptlib.py
├── promptlib2.py
├── promptlib\_cli.py
├── pyproject.toml
├── README.md
├── requirements.txt
├── scripts/
│   └── parse\_rawdata.py
├── test/                        # bats harness
│   ├── benchmark.sh
│   └── test\_scripts.bats
├── tests/                       # pytest suite
│   └── … (unit tests)
└── tickets/
└── … historical issue docs

````
> **Authoritative Snapshot** — any new path introduced must be justified by a ticket and appear in the next audit.

---

## 3 · Streams & Roles

| Prefix | Stream / Role            | Core Responsibilities                                                                            |
| ------ | ------------------------ | ------------------------------------------------------------------------------------------------ |
| **ARC**| Architecture & Governance| ADR authorship, divergence control, systemic risk assessment.                                   |
| **SHE**| Shell Engineering        | POSIX/bash scripts, fzf UX, clipboard handling, ShellCheck/shfmt compliance.                    |
| **PYL**| Python Library Eng.      | Dataset loaders, prompt generators, schema validators, performance tuning.                      |
| **CI** | CI/CD Automation         | GitHub Actions, release packaging, container builds, SBOM generation, artefact signing.         |
| **QA** | Quality & Security       | PyTest & Bats coverage, threat modelling, dependency scanning, CVE triage.                      |
| **DOC**| Documentation            | README, man pages, ADRs, diagrams, contributor guides.                                          |
| **INF**| Infrastructure           | Makefile orchestration, `.gitignore`, repo hygiene, cleanup tasks, Dockerfiles.                 |

---

## 4 · Ticket Matrix

> *Columns*: **ID · Stream · Title · Dependencies · Priority (P0 = blocker … P4 = nice-to-have) · Est. hrs**

| ID       | Stream | Title                                                             | Dependencies              | Prio | Est |
| -------- | ------ | ----------------------------------------------------------------- | ------------------------- | ---- | --- |
| **50-001**| SHE    | Align CLI with unified dataset format                             | 10-005, 10-004            | P0   | 3   |
| **50-002**| DOC    | Complete README and usage docs                                    | 20-001                    | P0   | 4   |
| **50-003**| SHE    | Clipboard robustness on Arch + Win/Mac                            | 30-001                    | P1   | 4   |
| **50-004**| CI     | Add release workflow & container build                            | 20-003, 10-007            | P1   | 5   |
| **50-005**| QA     | Integrate Bats & coverage in CI                                   | 10-006                    | P1   | 2   |
| **50-006**| QA     | Generate SBOM and document threat model                           | 10-007                    | P2   | 3   |
| **50-007**| ARC    | ADR-0001: Plugin system guidelines                                | 30-003                    | P2   | 2   |
| **50-008**| PYL    | Schema validation for dataset config                              | 30-002, 50-001            | P3   | 3   |
| **60-001**| INF    | Add `.gitignore` and cleanup repository hygiene                   | 10-001                    | P1   | 1   |
| **60-002**| DOC    | Finalize Man-Page (`prompts.1.scd`)                               | 20-002, 50-002            | P1   | 2   |
| **60-003**| INF    | Implement `make setup` and full Makefile targets                  | 50-002                    | P1   | 2   |
| **60-004**| INF    | Purge stale `__pycache__` directories                              | 50-001                    | P1   | 1   |
| **60-005**| QA     | End-to-end integration tests (shell ↔ python flow)               | 50-005                    | P1   | 3   |
| **60-006**| DOC    | Finalize Architecture ADR (`ADR-0001.md`)                         | 50-007                    | P1   | 2   |
| **60-007**| INF    | Clean dataset directory of unused files                           | 50-001                    | P2   | 1   |
| **60-008**| INF    | Standardize YAML ↔ JSON dataset conversion script                 | 50-001                    | P2   | 2   |
| **70-001**| INF    | Universal script-path resolution (`SCRIPT_DIR` fix)               | 60-001                    | P0   | 2   |
| **70-002**| CI     | SBOM generation + CycloneDX upload in release pipeline            | 50-006                    | P1   | 2   |
| **70-003**| DOC    | Write & ship ADR-0002 (dataset/schema longevity & versioning)     | 60-006                    | P2   | 2   |
| **70-004**| SHE    | Non-interactive CLI mode (`prompts.sh --pose … --desc …`)         | 50-001                    | P2   | 3   |
| **70-005**| QA     | Performance budget enforcement with `hyperfine`                   | 60-003                    | P2   | 1   |

---

## 5 · Detailed Ticket Specifications

> Each sub-section is **copy-ready** for GitHub Issue creation.  
> “LoE” = Level of Effort in hours (dev-time, not elapsed).  
> Implementation hints are advisory; teams may diverge with ARC approval.

---

### 50-001  SHE  Align CLI with unified dataset format
**Goal** — single *source of truth* for templates & slots across shell and python.  
**Context** — right now, Python tools read `dataset/templates.json` while bash scripts (`choose_prompt.sh` et al.) default to ad-hoc YAML in `data/`. Divergence causes inconsistent prompts.  
**Work-Items**
1. Deprecate `data/templates.yaml` and any parallel slot files.  
2. Refactor `bin/prompts.sh` and `bin/choose_prompt.sh` to read JSON via `jq` **or** call the Python API (preferred for DRY).  
3. Replace in-script placeholder logic with calls to `python -m promptlib.build …` (a new thin wrapper) or direct `python - <<EOF` snippet.  
4. Update Bats tests to load golden prompt samples from `tests/golden/`.  
5. Add README “Editing the dataset” section pointing to `dataset/templates.json` and `scripts/parse_rawdata.py`.  

**Acceptance Criteria**
- Running `bin/prompts.sh --random` and `python promptlib.py --category XYZ` produce identical output strings given identical seeds.  
- `data/` dir no longer contains any template YAML; CI fails if detected.  
- All unit + shell tests pass; coverage unchanged or improved.  
- README diff shows new dataset editing instructions.

**LoE:** 3 h  

---

### 50-002  DOC  Complete README and usage docs
*(see executive summary for gaps)*  
**Scope**  
1. Quick-Start (Makefile driven) with copy/paste installer for Arch.  
2. Architecture diagram embed (`docs/architecture.png`).  
3. Detailed section “Clipboard behaviour on Arch” (ties into 50-003).  
4. Link ADR-0001 once merged; cross-link man-page.  

**Acceptance**  
- `README.md` build passes markdown-lint; internal links valid.  
- Installing via Quick-Start reproduces working CLI on fresh Arch VM.

**LoE:** 4 h  

---

### 50-003  SHE  Clipboard robustness on Arch + Win/Mac
**Problem** — if `xclip` missing or DISPLAY unset, current shell path fails silently.  
**Deliverables**  
- `bin/clipboard.sh` library with detection matrix:  
  * Arch X11: `command -v xclip` → `xclip -selection clipboard`.  
  * Wayland: try `wl-copy`.  
  * macOS: `pbcopy`.  
  * Windows WSL: `clip.exe` via `/mnt/c/Windows/System32/clip.exe` else fallback.  
- Unit tests using `shellspec` or Bats (mocking commands).  
- README update.

**LoE:** 4 h  

---

### 50-004  CI  Add release workflow & container build
**Tasks**  
1. `.github/workflows/release.yml`: triggered on semver tag `v*.*.*`.  
2. Steps: checkout → `make setup` → tests → `docker build` → push to GHCR.  
3. Attach artefacts: `4ndr0prompts-vX.Y.Z.tar.gz`, CycloneDX SBOM (70-002), docker image digest.  
4. Use `docker buildx --platform linux/amd64,linux/arm64`.  
5. Auto-update `CHANGELOG.md` using Conventional Commits + `release-please`.  

**Acceptance**  
- Tagging `v0.2.0` in a fork produces a draft release with assets.  
- Image size < 10 MB; `docker run ... prompts --help` works.

**LoE:** 5 h  

---

### 50-005  QA  Integrate Bats & coverage in CI
**Tasks**  
- Add `bats-core` install step in CI.  
- Run `bats test/*.bats`; collect coverage with `bashcov` (or minimal pass/fail).  
- Combine with `pytest-cov` via `coverage combine`.  
- Fail job if combined line coverage < 95 %.

**LoE:** 2 h  

---

### 50-006  QA  Generate SBOM and document threat model
*(see follow-up 70-002 for SBOM automation details)*  
- `scripts/gen_sbom.sh` uses `cyclonedx-py` to emit JSON.  
- `docs/SECURITY.md` with at least 4 threat scenarios: plugin spoofing, clipboard hijack, supply-chain vuln, dataset poisoning.

**LoE:** 3 h  

---

### 50-007  ARC  ADR-0001: Plugin system guidelines
**Context** — `plugin_loader.py` allows 3 formats; governance needed.  
**Sections** — Context → Decision → Consequences → Alternatives.  
Include category normalisation table and security considerations (sandboxing, path traversal).  

**LoE:** 2 h  

---

### 50-008  PYL  Schema validation for dataset config
**Deliverables**  
- `docs/dataset.schema.json` (draft by ARC, enforced by PYL).  
- Validator script `scripts/validate_dataset.py` using `jsonschema`.  
- Pre-commit hook and `make validate`.  

**LoE:** 3 h  

---

### 60-001  INF  Add `.gitignore` and repo hygiene
*(minimal tasks; self-explanatory)*  

**LoE:** 1 h  

---

### 60-002  DOC  Finalize Man-Page (`prompts.1.scd`)
- Flesh out NAME, SYNOPSIS, DESCRIPTION, OPTIONS, EXAMPLES.  
- Ensure `scdoc < man1/prompts.1.scd > man1/prompts.1` builds without warnings.  

**LoE:** 2 h  

---

### 60-003  INF  Implement `make setup` and full Makefile
Targets: `setup validate test clean bench sbom`.  
Ensure idempotent on Arch.  

**LoE:** 2 h  

---

### 60-004  INF  Purge stale `__pycache__`
Add a make target and gitignore; trivial.  

**LoE:** 1 h  

---

### 60-005  QA  E2E integration tests
Use Bats to run `bin/choose_prompt.sh` -> `prompts.sh` → assert prompt syntactically valid and on clipboard or stdout fallback.  

**LoE:** 3 h  

---

### 60-006  DOC  Finalize Architecture ADR (ADR-0001.md)
Merge review, Glossary injection, diagrams.  

**LoE:** 2 h  

---

### 60-007  INF  Clean dataset directory
Audit for `nsfwprompts.txt` usage; delete if not referenced; else move to `archive/`.  

**LoE:** 1 h  

---

### 60-008  INF  Dataset conversion script
`scripts/convert_dataset.py` round-trip YAML<->JSON; integrate into `make validate`.  

**LoE:** 2 h  

---

### 70-001  INF  Universal script-path resolution (`SCRIPT_DIR` fix)
Insert:

```bash
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
````

into every executable shell script; adjust Python scripts similarly with `Path(__file__).resolve().parent`.

**LoE:** 2 h

---

### 70-002  CI  SBOM generation + CycloneDX upload

Extend release.yml: `pip install cyclonedx-bom` → `cyclonedx-py -o sbom.json`; attach artefact; sign with cosign keyless.

**LoE:** 2 h

---

### 70-003  DOC  ADR-0002 – Dataset longevity & versioning

Document semantic versioning for `templates.json`, rolling deprecations, and conversion strategy.

**LoE:** 2 h

---

### 70-004  SHE  Non-interactive CLI mode

Add flags:

```
prompts.sh --pose "kneeling" --desc "steam-punk alley" --count 3
```

which call `python -m promptlib --category ... --slots ...`.

**LoE:** 3 h

---

### 70-005  QA  Performance budget enforcement

`hyperfine --warmup 3 "bin/prompts.sh --random" -N -u millisecond` in CI; fail if > 50 ms.

**LoE:** 1 h

---

*(End of Ticket Specs)*

---

## 6 · Roadmap & Sprint Cadence

| Sprint  | Focus Area                                        | Primary Tickets                                     | Time-box |
| ------- | ------------------------------------------------- | --------------------------------------------------- | -------- |
| **S-1** | Dataset unification · Docs skeleton · CI baseline | 50-001 · 50-002 · 50-005 · 60-001 · 60-003 · 70-001 | 14 days  |
| **S-2** | Cross-platform UX · Release machinery · Man page  | 50-003 · 50-004 · 50-006 · 60-002 · 60-005          | 14 days  |
| **S-3** | Plugin ADR + Schema enforcement                   | 50-007 · 50-008 · 60-006 · 70-002                   | 14 days  |
| **S-4** | Infra cleanup · Dataset converter · Perf budget   | 60-004 · 60-007 · 60-008 · 70-003 · 70-004 · 70-005 | 10 days  |

---

## 7 · Automation & Infrastructure Mandates

| Domain         | Requirement                                                                        |
| -------------- | ---------------------------------------------------------------------------------- |
| **GitHub CI**  | Workflows: `ci.yml` (lint/pytest/bats/coverage) + `release.yml` (build & publish). |
| **Pre-commit** | Hooks: Ruff, Black, ShellCheck, shfmt, pytest, bats, coverage ≥95 %.               |
| **Docker**     | Alpine base; image size < 10 MB; multi-arch build; GHCR push.                      |
| **SBOM**       | CycloneDX JSON; published with GitHub release; cosign keyless sign.                |
| **Makefile**   | `setup`, `validate`, `test`, `bench`, `sbom`, `clean`.                             |
| **Perf**       | `hyperfine` budget: prompt generation < 50 ms on GHA runner.                       |
| **Security**   | Dependabot + `safety` or `pip-audit`; fail CI on high-severity CVEs.               |
| **Secrets**    | PAT only for GHCR; use GHA OIDC where possible.                                    |

---

## 8 · Approval Rubric (Go/No-Go)

| Area            | Threshold                                                          | Verification                             |
| --------------- | ------------------------------------------------------------------ | ---------------------------------------- |
| **Tests**       | ≥ 95 % combined coverage; 0 failing Bats/pytest.                   | coverage combine · junit report          |
| **Static Lint** | Ruff: 0 errors; ShellCheck: 0 SC2xxx; Black diff = 0.              | pre-commit + CI                          |
| **Build Repro** | Same git tree ➔ identical tarball & docker digest (`sha256`).      | CI job runs twice, compares `sha256sum`. |
| **Performance** | CLI cold start < 50 ms (average of 3 runs).                        | `hyperfine` in bench job                 |
| **Security**    | SBOM attached; no HIGH CVEs open; threat model reviewed.           | grype scan + manual review               |
| **Docs**        | README, ADR-0001, man page pass lint; architecture diagram linked. | markdown-lint + human approval           |

**Failing any line = NO-GO, escalate to ARC for remediation.**

---

## 9 · Contribution Workflow

1. **Fork → branch** (`feat/{ticketID}-{slug}`) off `main`.
2. Run `make setup` (installs pip deps, bats, shellcheck, pre-commit).
3. Develop *with* tests; commit using Conventional Commits + `Signed-off-by:`.
4. `pre-commit run --all-files` must pass before push.
5. Open PR; add ticket ID in title; assign reviewers from *Streams & Roles*.
6. CI must be green; once approved, **Squash & Merge** using “Create a merge commit”.
7. Tag release (when merging release branch) triggers `release.yml`.

---

## 10 · Further Enhancements (Post-Release)

| Idea                            | Benefit                                    | Effort | Notes                            |
| ------------------------------- | ------------------------------------------ | ------ | -------------------------------- |
| ⚡ **fzf Preview Pane**          | Live diff between template & filled prompt | Med.   | Use `bat` with `--color=always`. |
| 🔖 **Template Versioning**      | Historical rollbacks of prompt packs       | High   | Requires ADR-0003.               |
| 🌐 **Web UI (Textual / Toga)**  | Browser-free GUI for non-terminal users    | Med.   | Optional, separate package.      |
| 🛠️ **Marketplace for Plugins** | Community-curated prompt packs             | High   | Needs security gate + signing.   |

---

## 11 · Glossary

| Term          | Meaning                                          |
| ------------- | ------------------------------------------------ |
| **ADR**       | Architecture Decision Record (see `docs/ADR-*`). |
| **SBOM**      | Software Bill of Materials (CycloneDX format).   |
| **LoE**       | Level of Effort (dev-hours estimate).            |
| **Bats**      | Bash Automated Testing System.                   |
| **CycloneDX** | Industry SBOM specification.                     |

---

## Appendix A — Ticket YAML Stub

```yaml
id: 50-999
stream: SHE
title: Example Ticket Title
dependencies: []
priority: P3     # P0 blocker … P4 stretch
est_hours: 2
description: |
  One-paragraph overview of what must be built or changed.
acceptance_criteria:
  - Bullet list of measurable conditions.
deliverables:
  - Code file(s)
  - Documentation page(s)
notes: |
  Optional hints, links, design references.
```

## Appendix B — ADR Template

```md
# ADR-???? – <Decision Title>
Status: Proposed
Date: YYYY-MM-DD

## Context
What questions are we answering?  Why now?

## Decision
Concise statement of choice and scope.

## Consequences
### Positive
- …

### Negative
- …

## Alternatives Considered
- Option A – …
- Option B – …
```

---

<!-- END OF AGENTS.md -->
